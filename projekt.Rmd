---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Nataša Taškov"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
runtime: shiny
---

```{r setup, echo=FALSE, results='hide', message=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding = "UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding = "UTF-8")
```

# Izbira teme

V projektu bom analizirala vpliv zdravstvene ureditve v povezavi s pričakovano življenjsko dobo v posameznih državah. Analizirala bom, kako dejavne so posamezne države na posameznih področjih v zdravstvu, kateri so glavni ponudniki zdravstvenih storitev in kakšna je shema financiranja zdravstva v posameznih državah. Cilj projekta je poiskati, kakšna ureditev zdravstvenega sistema je najbolj optimalna za državo.

Tabela 1: PRIČAKOVANA ŽIVLJENJSKA DOBA

 * stolpec 1: Leto (število)
 * stolpec 2: Država (faktor)
 * stolpec 3: Spol (faktor)
 * stolpec 4: Starost (število)
 * stolpec 5: Pričakovana življenjska doba (realno število)

Tabela 2: IZDATKI ZA POSAMEZNE FUNKCIJE ZDRAVSTVENE NEGE

 * stolpec 1: Leto (število)
 * stolpec 2: Država (faktor)
 * stolpec 3: Funkcija (faktor)
 * stolpec 4: Izdatki za posamezno funkcijo (realno število)

Tabela 3: IZDATKI PONUDNIKOV ZDRAVSTVENIH STORITEV

 * stolpec 1: Leto (število)
 * stolpec 2: Država (faktor)
 * stolpec 3: Ponudnik (faktor)
 * stolpec 4: Izdatki posameznih ponudnikov (realno število)

Tabela 4: SHEME FINANCIRANJA ZDRAVSTVENIH STORITEV

 * stolpec 1: Leto (število)
 * stolpec 2: Država (faktor)
 * stolpec 3: Shema financiranja (faktor)
 * stolpec 4: Izdatki (realno število)

Viri:

 * http://appsso.eurostat.ec.europa.eu/nui/show.do?dataset=demo_mlexpec&lang=en

 * http://appsso.eurostat.ec.europa.eu/nui/show.do?dataset=hlth_sha11_hc&lang=en

 * http://appsso.eurostat.ec.europa.eu/nui/show.do?dataset=hlth_sha11_hp&lang=en

 * http://appsso.eurostat.ec.europa.eu/nui/show.do?dataset=hlth_sha11_hf&lang=en


***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE, warning=FALSE}
source("uvoz/uvoz.r", encoding = "UTF-8")
```

Podatke o pričakovani življenjski dobi, o izdatkih za posamezne funkcije zdravstvene nege, izdatkih ponidnikov zdravstvenih storitev in shemi financiranja zdravstvenih storitev sem uvozila iz Eurostata. Prve tri tabele sem uvozila v obliki CSV zadnjo tabelo pa v obliki HTML.

```{r razpredelnice, message=FALSE, warning=FALSE}
kable(head(pricakovana.zivljenjska.doba))

kable(head(funkcije.zdravstvene.nege))

kable(head(ponudniki.zdravstvenih.storitev))

kable(head(shema.financiranja))
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE}
#source("vizualizacija/vizualizacija.r", encoding = "UTF-8")
```

Slika \ref{fig:zemljevid} prikazuje pričakovano življenjsko dobo za posamezno državo v letu 2015.

```{r zemljevid, echo=FALSE, fig.align='center', fig.cap='Zemljevid pričakovane življenjske dobe.', message=FALSE, warning=FALSE}
evropa <- uvozi.zemljevid("http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/cultural/ne_50m_admin_0_countries.zip",
                          "ne_50m_admin_0_countries", encoding = "UTF-8") %>%
  pretvori.zemljevid() %>% filter(CONTINENT == "Europe" | SOVEREIGNT %in% c("Turkey", "Cyprus"),
                                  long > -30, SOVEREIGNT != "Russia")
ggplot() + geom_polygon(data = evropa %>% left_join(pricakovana.zivljenjska.doba %>%
                                                      filter(Leto == 2015),
                                                    by = c("NAME_LONG" = "Drzava")),
                        aes(x = long, y = lat, group = group, fill = Vrednost)) +
  coord_map(xlim = c(-25, 45), ylim = c(32, 72))
```


Slika \ref{fig:zemljevid} prikazuje, za katero skupino funkcij zdravstvenih storitev so posamezne države namenile največ denarja.

```{r zem, echo=FALSE, fig.align='center', fig.cap='Zemljevid funkcij zdravstvene nege.', message=FALSE, warning=FALSE}
ggplot() + geom_polygon(data = evropa %>%
                          left_join(funkcije.zdravstvene.nege %>%
                                      filter(Leto == 2014) %>%
                                      group_by(Drzava) %>% top_n(1, Vrednost),
                                    by = c("NAME_LONG" = "Drzava")),
                        aes(x = long, y = lat, group = group, fill = Funkcija)) +
  coord_map(xlim = c(-25, 45), ylim = c(32, 72))
```
# Napredna analiza podatkov

```{r analiza, echo=FALSE, message=FALSE, warning=FALSE}
source("analiza/analiza.r", encoding = "UTF-8")
```

Spodnji tabeli prikazujeta prvih 6 držav z najdaljšo in najdaljšo življenjsko dobo.
```{r razpredelnice1, message=FALSE, warning=FALSE}
kable(head(najkrajsa))

kable(head(najdaljsa))
```


Sedaj si oglejmo analizo posebej za eno državo z najkrajšo življenjsko dobo in eno državo z najkrajšo življenjsko dobo. Izbrala sem Latvijo in Švico.

Spodnji graf prikazuje kako se je spreminjala pričakovana življenjska doba v času za Švico in Latvijo. 

```{r graf, echo=FALSE, fig.align='center', fig.cap='Zivljenjska doba  v casu za Latvijo in Svico', message=FALSE, warning=FALSE}
g11
```

Naslednji graf prikazuje,koliko eurov na prebivalca je namenila posamezna država za zdravstveno nego v celoti v času, konkretno zopet za Latvijo in Švico.
```{r graf1, echo=FALSE, fig.align='center', fig.cap='Zdravstvena nega za Latvijo in Svico', message=FALSE, warning=FALSE}
g21
```

Spodnji histogram prikazuje odvisnost pričakovane življenjske dobe glede na starost posameznika.
```{r graf2, echo=FALSE, fig.align='center', fig.cap='Zivljenjska doba glede na starost', message=FALSE, warning=FALSE}
hist(t3$doba, xlab="Starost", ylab="Pricakovana zivljenjska doba",
           main="")
```

Na koncu pa sledi še prikaz, koliko denarja posamezna država nameni za posameznega ponudnika zdravstvenih storitev. Konkretno za Švico in Latvijo.
```{r graf3, echo=FALSE, fig.align='center', fig.cap='Ponudniki zdravstvenih storitev', message=FALSE, warning=FALSE}
g41
```

***

```{r shiny, echo = FALSE, message=FALSE, warning=FALSE}
shinyAppDir("shiny", options=list(width="100%", height=600))
```


